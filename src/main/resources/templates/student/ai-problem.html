<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ë¬¸ì œ í’€ì´ - ì½”ë“œë°°í‹€ì•„ë ˆë‚˜</title>
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/student.css">
    <style>
        .problem-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            height: calc(100vh - 200px);
            margin-top: 2rem;
        }
        .problem-content {
            background: #1e293b;
            color: #e2e8f0;
            padding: 2rem;
            border-radius: 0.75rem;
            overflow-y: auto;
        }
        .code-editor {
            background: #0f172a;
            padding: 2rem;
            border-radius: 0.75rem;
            display: flex;
            flex-direction: column;
        }
        #codeTextarea {
            flex: 1;
            min-height: 400px;
            background: #0f172a;
            color: #e2e8f0;
            border: 1px solid #475569;
            border-radius: 0.5rem;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
        }
        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        .result-panel {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            background: #1e293b;
            color: #e2e8f0;
            display: none;
        }
    </style>
<link rel="stylesheet" href="/css/mobile.css">
<script src="/js/mobile.js">
</head>
<body>
    <div class="header">
        <div class="nav">
            <a href="/" class="logo">ì½”ë“œë°°í‹€ì•„ë ˆë‚˜</a>
            <ul class="nav-links">
                <li><a href="/student">ëŒ€ì‹œë³´ë“œ</a></li>
                <li><a href="/student/today">ì˜¤ëŠ˜ì˜ í•™ìŠµ</a></li>
                <li><a href="#" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a></li>
            </ul>
        </div>
    </div>

    <div class="student-dashboard">
        <div class="student-header">
            <h1 class="student-title">AI ì¶”ì²œ ë¬¸ì œ</h1>
            <p class="student-subtitle">AIê°€ ë‹¹ì‹ ì˜ ìˆ˜ì¤€ì— ë§ëŠ” ë¬¸ì œë¥¼ ì¶”ì²œí–ˆìŠµë‹ˆë‹¤</p>
        </div>

        <div class="problem-container">
            <div class="problem-content">
                <h2 id="problemTitle">ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h2>
                <div id="problemMeta" style="margin: 1rem 0; color: #94a3b8;"></div>
                
                <h3>ë¬¸ì œ ì„¤ëª…</h3>
                <div id="problemDescription" style="margin-bottom: 2rem; line-height: 1.6; background: #334155; padding: 1.5rem; border-radius: 0.5rem;">
                    ë¬¸ì œ ì„¤ëª…ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </div>

                <h3>ì…ì¶œë ¥ ì˜ˆì œ</h3>
                <div id="problemExample" style="background: #334155; padding: 1.5rem; border-radius: 0.5rem; font-family: monospace; white-space: pre-line;">
                    ì˜ˆì œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </div>

                <h3>ì œì•½ ì¡°ê±´</h3>
                <div id="problemConstraints" style="background: #334155; padding: 1.5rem; border-radius: 0.5rem;">
                    ì œì•½ ì¡°ê±´ì„ í™•ì¸í•˜ëŠ” ì¤‘...
                </div>
            </div>

            <div class="code-editor">
                <h3 style="color: #e2e8f0; margin-bottom: 1rem;">ì½”ë“œ ì‘ì„±</h3>
                <textarea id="codeTextarea" placeholder="ì—¬ê¸°ì— ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”...

public class Solution {
    public static void main(String[] args) {
        // ì—¬ê¸°ì— ì½”ë“œë¥¼ ì‘ì„±í•˜ì„¸ìš”
        
    }
}"></textarea>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="testCode()">í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
                    <button class="btn" onclick="submitSolution()">ì œì¶œí•˜ê¸°</button>
                    <button class="btn" style="background: #6b7280;" onclick="goBack()">ë’¤ë¡œê°€ê¸°</button>
                </div>

                <div id="resultPanel" class="result-panel">
                    <h4>ì‹¤í–‰ ê²°ê³¼</h4>
                    <div id="resultContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/common/auth.js"></script>
    <script>
        const aiProblems = [
            {
                id: "ai_001",
                title: "ë‘ ìˆ˜ì˜ í•© êµ¬í•˜ê¸°",
                difficulty: "í•˜",
                points: 10,
                description: "ë‘ ì •ìˆ˜ Aì™€ Bë¥¼ ì…ë ¥ë°›ì•„ A+Bë¥¼ ì¶œë ¥í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•˜ì‹œì˜¤.\n\nì´ ë¬¸ì œëŠ” ê°€ì¥ ê¸°ë³¸ì ì¸ ì…ì¶œë ¥ ë¬¸ì œì…ë‹ˆë‹¤. í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì˜ ê¸°ë³¸ ë¬¸ë²•ì„ ìµíˆëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.",
                example: "ì…ë ¥:\n1 2\n\nì¶œë ¥:\n3\n\nì…ë ¥:\n5 7\n\nì¶œë ¥:\n12",
                constraints: "â€¢ -1000 â‰¤ A, B â‰¤ 1000\nâ€¢ ì…ë ¥ì€ í•œ ì¤„ì— ë‘ ì •ìˆ˜ê°€ ê³µë°±ìœ¼ë¡œ êµ¬ë¶„ë˜ì–´ ì£¼ì–´ì§‘ë‹ˆë‹¤\nâ€¢ ì¶œë ¥ì€ í•œ ì¤„ì— ê²°ê³¼ê°’ í•˜ë‚˜ë§Œ ì¶œë ¥í•©ë‹ˆë‹¤",
                testCases: [
                    { input: "1 2", expectedOutput: "3" },
                    { input: "5 7", expectedOutput: "12" },
                    { input: "-1 3", expectedOutput: "2" }
                ]
            },
            {
                id: "ai_002", 
                title: "ë°°ì—´ì—ì„œ ìµœëŒ“ê°’ ì°¾ê¸°",
                difficulty: "ì¤‘",
                points: 20,
                description: "Nê°œì˜ ì •ìˆ˜ê°€ ì£¼ì–´ì¡Œì„ ë•Œ, ì´ ì¤‘ì—ì„œ ê°€ì¥ í° ê°’ì„ ì°¾ì•„ ì¶œë ¥í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ì‘ì„±í•˜ì‹œì˜¤.\n\në°°ì—´ì„ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬ ê°œì˜ ê°’ì„ ì²˜ë¦¬í•˜ëŠ” ë°©ë²•ì„ í•™ìŠµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                example: "ì…ë ¥:\n5\n3 7 2 9 1\n\nì¶œë ¥:\n9\n\nì…ë ¥:\n4\n-1 -5 -3 -2\n\nì¶œë ¥:\n-1",
                constraints: "â€¢ 1 â‰¤ N â‰¤ 100\nâ€¢ -1000 â‰¤ ê° ì›ì†Œ â‰¤ 1000\nâ€¢ ì²« ë²ˆì§¸ ì¤„ì— Nì´ ì£¼ì–´ì§‘ë‹ˆë‹¤\nâ€¢ ë‘ ë²ˆì§¸ ì¤„ì— Nê°œì˜ ì •ìˆ˜ê°€ ê³µë°±ìœ¼ë¡œ êµ¬ë¶„ë˜ì–´ ì£¼ì–´ì§‘ë‹ˆë‹¤",
                testCases: [
                    { input: "5\n3 7 2 9 1", expectedOutput: "9" },
                    { input: "4\n-1 -5 -3 -2", expectedOutput: "-1" },
                    { input: "3\n10 10 10", expectedOutput: "10" }
                ]
            }
        ];

        let currentProblem = null;

        function loadRandomProblem() {
            const randomIndex = Math.floor(Math.random() * aiProblems.length);
            currentProblem = aiProblems[randomIndex];
            
            document.getElementById('problemTitle').textContent = currentProblem.title;
            document.getElementById('problemMeta').innerHTML = `
                <span style="background: ${getDifficultyColor(currentProblem.difficulty)}; color: white; padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.8rem; margin-right: 0.5rem;">${currentProblem.difficulty}</span>
                <span>${currentProblem.points}ì </span>
            `;
            document.getElementById('problemDescription').textContent = currentProblem.description;
            document.getElementById('problemExample').textContent = currentProblem.example;
            document.getElementById('problemConstraints').textContent = currentProblem.constraints;
        }

        function getDifficultyColor(difficulty) {
            switch(difficulty) {
                case 'í•˜': return '#10b981';
                case 'ì¤‘': return '#f59e0b'; 
                case 'ìƒ': return '#ef4444';
                default: return '#6b7280';
            }
        }

        function testCode() {
            const code = document.getElementById('codeTextarea').value.trim();
            const resultPanel = document.getElementById('resultPanel');
            const resultContent = document.getElementById('resultContent');
            
            if (!code) {
                resultContent.innerHTML = '<div style="color: #ef4444;">ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>';
                resultPanel.style.display = 'block';
                return;
            }

            resultContent.innerHTML = '<div style="color: #3b82f6;">í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...</div>';
            resultPanel.style.display = 'block';
            
            setTimeout(() => {
                const results = runTestCases(code);
                displayTestResults(results);
            }, 1500);
        }

        function runTestCases(code) {
            if (!currentProblem || !currentProblem.testCases) {
                return { success: false, message: "í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤." };
            }

            // ê°„ë‹¨í•œ ì½”ë“œ ê²€ì¦
            if (code.length < 30) {
                return { success: false, message: "ì½”ë“œê°€ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤. ë” ìì„¸íˆ ì‘ì„±í•´ì£¼ì„¸ìš”." };
            }

            if (!code.includes('System.out.print') && !code.includes('print') && !code.includes('cout')) {
                return { success: false, message: "ì¶œë ¥ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤. System.out.println() ë“±ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”." };
            }

            // AI ê¸°ë°˜ ì •ë‹µ íŒì • ì‹œë®¬ë ˆì´ì…˜
            const passedTests = [];
            const failedTests = [];

            currentProblem.testCases.forEach((testCase, index) => {
                const isCorrect = checkSolution(code, testCase, currentProblem.id);
                
                if (isCorrect) {
                    passedTests.push({ index: index + 1, input: testCase.input, expected: testCase.expectedOutput });
                } else {
                    failedTests.push({ index: index + 1, input: testCase.input, expected: testCase.expectedOutput, actual: "ì˜¤ë‹µ" });
                }
            });

            return {
                success: failedTests.length === 0,
                passedTests,
                failedTests,
                totalTests: currentProblem.testCases.length
            };
        }

        function checkSolution(code, testCase, problemId) {
            // AI ê¸°ë°˜ ì •ë‹µ íŒì • ë¡œì§ ì‹œë®¬ë ˆì´ì…˜
            if (problemId === "ai_001") {
                // ë‘ ìˆ˜ì˜ í•©: ë§ì…ˆ ì—°ì‚°ì´ ìˆëŠ”ì§€ í™•ì¸
                return code.includes('+') || code.includes('add') || code.includes('sum');
            } else if (problemId === "ai_002") {
                // ìµœëŒ“ê°’: Math.maxë‚˜ ë¹„êµ ì—°ì‚°ì´ ìˆëŠ”ì§€ í™•ì¸
                return code.includes('Math.max') || (code.includes('for') && code.includes('>')) || code.includes('max');
            }
            
            // ê¸°ë³¸ì ìœ¼ë¡œ 70% í™•ë¥ ë¡œ ì •ë‹µ
            return Math.random() > 0.3;
        }

        function displayTestResults(results) {
            const resultContent = document.getElementById('resultContent');
            
            if (results.success) {
                resultContent.innerHTML = `
                    <div style="color: #10b981; margin-bottom: 1rem;">
                        <strong>âœ… ëª¨ë“  í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ í†µê³¼! (${results.passedTests.length}/${results.totalTests})</strong>
                    </div>
                    ${results.passedTests.map(test => `
                        <div style="background: #065f46; padding: 0.5rem; border-radius: 0.25rem; margin-bottom: 0.5rem;">
                            <strong>í…ŒìŠ¤íŠ¸ ${test.index}:</strong> í†µê³¼<br>
                            <small>ì…ë ¥: ${test.input.replace(/\n/g, ' ')} â†’ ì¶œë ¥: ${test.expected}</small>
                        </div>
                    `).join('')}
                    <div style="margin-top: 1rem; color: #10b981;">
                        <strong>ì œì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</strong>
                    </div>
                `;
            } else {
                resultContent.innerHTML = `
                    <div style="color: #ef4444; margin-bottom: 1rem;">
                        <strong>âŒ ${results.failedTests ? results.failedTests.length : 0}ê°œ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ (${results.passedTests ? results.passedTests.length : 0}/${results.totalTests} í†µê³¼)</strong>
                    </div>
                    ${results.message ? `<div style="color: #f59e0b; margin-bottom: 1rem;">${results.message}</div>` : ''}
                    ${results.failedTests ? results.failedTests.map(test => `
                        <div style="background: #7f1d1d; padding: 0.5rem; border-radius: 0.25rem; margin-bottom: 0.5rem;">
                            <strong>í…ŒìŠ¤íŠ¸ ${test.index}:</strong> ì‹¤íŒ¨<br>
                            <small>ì…ë ¥: ${test.input.replace(/\n/g, ' ')}<br>ê¸°ëŒ“ê°’: ${test.expected}<br>ì‹¤ì œê°’: ${test.actual}</small>
                        </div>
                    `).join('') : ''}
                    ${results.passedTests ? results.passedTests.map(test => `
                        <div style="background: #065f46; padding: 0.5rem; border-radius: 0.25rem; margin-bottom: 0.5rem;">
                            <strong>í…ŒìŠ¤íŠ¸ ${test.index}:</strong> í†µê³¼<br>
                            <small>ì…ë ¥: ${test.input.replace(/\n/g, ' ')} â†’ ì¶œë ¥: ${test.expected}</small>
                        </div>
                    `).join('') : ''}
                `;
            }
        }

        function submitSolution() {
            const code = document.getElementById('codeTextarea').value.trim();
            
            if (!code) {
                alert('ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const results = runTestCases(code);
            const score = Math.round((results.passedTests.length / results.totalTests) * 100);
            
            if (results.success) {
                alert(`ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!\n\nì ìˆ˜: ${currentProblem.points}ì \nì •í™•ë„: 100%\n\në‹¤ìŒ ë¬¸ì œë¥¼ ë„ì „í•´ë³´ì„¸ìš”!`);
            } else {
                alert(`ì œì¶œ ì™„ë£Œ!\n\nì ìˆ˜: ${Math.round(score * currentProblem.points / 100)}ì \nì •í™•ë„: ${score}%\n\ní†µê³¼í•œ í…ŒìŠ¤íŠ¸: ${results.passedTests.length}/${results.totalTests}ê°œ`);
            }
            
            setTimeout(() => {
                if (confirm('ë‹¤ë¥¸ AI ë¬¸ì œë¥¼ í’€ì–´ë³´ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    loadRandomProblem();
                    document.getElementById('codeTextarea').value = '';
                    document.getElementById('resultPanel').style.display = 'none';
                } else {
                    goBack();
                }
            }, 1000);
        }

        function goBack() {
            window.location.href = '/student/today';
        }

        function logout() {
            AuthManager.logout();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ëœë¤ ë¬¸ì œ ë¡œë“œ
        loadRandomProblem();
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <script src="/js/common/websocket.js"></script>
    <script src="/js/common/student-activity.js"></script>
</body>
</html>

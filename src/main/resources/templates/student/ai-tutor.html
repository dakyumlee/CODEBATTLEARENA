<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI íŠœí„° - ì½”ë“œë°°í‹€ì•„ë ˆë‚˜</title>
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/student.css">
</head>
<body>
    <div class="header">
        <div class="nav">
            <a href="/" class="logo">ì½”ë“œë°°í‹€ì•„ë ˆë‚˜</a>
            <ul class="nav-links">
                <li><a href="/student">ëŒ€ì‹œë³´ë“œ</a></li>
                <li><a href="#" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a></li>
            </ul>
        </div>
    </div>

    <div class="student-dashboard">
        <div class="student-header">
            <h1 class="student-title">AI íŠœí„°</h1>
            <p class="student-subtitle">ê¶ê¸ˆí•œ ê²ƒì„ AIì—ê²Œ ë¬¼ì–´ë³´ì„¸ìš”</p>
        </div>

        <div class="card" style="height: 70vh; display: flex; flex-direction: column;">
            <div id="chatMessages" style="flex: 1; overflow-y: auto; padding: 1rem; border: 1px solid #334155; border-radius: 0.5rem; margin-bottom: 1rem; background: #0f172a;">
                <div class="chat-message ai-message">
                    <div style="background: #334155; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                        <strong>AI íŠœí„°:</strong> ì•ˆë…•í•˜ì„¸ìš”! ì½”ë”© í•™ìŠµì— ëŒ€í•´ ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”. ğŸ¤–
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 1rem;">
                <textarea id="messageInput" class="input" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." style="flex: 1; min-height: 60px; resize: vertical;" onkeypress="handleKeyPress(event)"></textarea>
                <button class="btn" onclick="sendMessage()" style="height: fit-content;">ì „ì†¡</button>
            </div>
        </div>

        <div class="card">
            <h3>ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                <button class="btn btn-secondary" onclick="askPredefinedQuestion('ìë°” ê¸°ì´ˆ ë¬¸ë²• ì„¤ëª…í•´ì¤˜')">ìë°” ê¸°ì´ˆ ë¬¸ë²•</button>
                <button class="btn btn-secondary" onclick="askPredefinedQuestion('ì•Œê³ ë¦¬ì¦˜ ê³µë¶€ ë°©ë²•')">ì•Œê³ ë¦¬ì¦˜ ê³µë¶€ë²•</button>
                <button class="btn btn-secondary" onclick="askPredefinedQuestion('ë°°ì—´ê³¼ ë¦¬ìŠ¤íŠ¸ ì°¨ì´ì ')">ë°°ì—´ vs ë¦¬ìŠ¤íŠ¸</button>
                <button class="btn btn-secondary" onclick="askPredefinedQuestion('ê°ì²´ì§€í–¥ í”„ë¡œê·¸ë˜ë°ì´ë€')">ê°ì²´ì§€í–¥ ê°œë…</button>
            </div>
        </div>
    </div>

    <script src="/js/common/auth.js"></script>
    <script src="/js/common/api.js"></script>
    <script>
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) return;

            addChatMessage(message, 'user');
            input.value = '';

            try {
                const response = await ApiClient.post('/api/ai/chat', { message });
                addChatMessage(response.response, 'ai');
            } catch (error) {
                addChatMessage('ì£„ì†¡í•©ë‹ˆë‹¤. AI ì„œë²„ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'ai', true);
                console.error('AI ì±„íŒ… ì˜¤ë¥˜:', error);
            }
        }

        function addChatMessage(message, sender, isError = false) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}-message`;
            
            const bgColor = sender === 'user' ? '#3b82f6' : (isError ? '#ef4444' : '#334155');
            const senderName = sender === 'user' ? 'ë‚˜' : 'AI íŠœí„°';
            
            messageDiv.innerHTML = `
                <div style="background: ${bgColor}; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; ${sender === 'user' ? 'margin-left: 20%; text-align: right;' : ''}">
                    <strong>${senderName}:</strong> ${message}
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function askPredefinedQuestion(question) {
            document.getElementById('messageInput').value = question;
            sendMessage();
        }

        function logout() {
            AuthManager.logout();
        }
    </script>
</body>
</html>
